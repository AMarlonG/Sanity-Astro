---
import ContentPageLayout from '../layouts/ContentPageLayout.astro';
import { createDataService } from '../lib/sanity/dataService.js';

// Create data service with Visual Editing support
const dataService = createDataService(Astro.request);

// Load homepage using data service
const homepage = await dataService.getHomepage();

const homepageTitle = homepage?.title || 'Forside';

// Smart caching basert p책 innholdstype
if (homepage?.scheduledPeriod) {
  const timeUntilExpiry = new Date(homepage.scheduledPeriod.endDate).getTime() - Date.now();
  const cacheTime = Math.min(timeUntilExpiry / 1000, 300); // Maks 5 minutter

  Astro.response.headers.set('Cache-Control', `public, max-age=${cacheTime}`);
} else {
  Astro.response.headers.set('Cache-Control', 'public, max-age=3600'); // 1 time
}

console.log('Aktiv forside:', homepage);
---

<ContentPageLayout title={homepageTitle} pageDocument={homepage}>
  {!homepage && (
    <div class="no-content">
      <h1>Velkommen til forsiden</h1>
      <p>Ingen forside er konfigurert enn책. G책 til Sanity Studio for 책 opprette en forside.</p>
    </div>
  )}
</ContentPageLayout>

<style>
  .no-content {
    margin: 0;
  }
</style>
