---
import ContentPageLayout from '../layouts/ContentPageLayout.astro';
import CardGrid from '../components/CardGrid.astro';
import Image from '../components/Image.astro';
import { createDataService } from '../lib/sanity/dataService.js';
import { formatDateForLanguage } from '../../../shared/utils/dates';

// Create data service with Visual Editing support
const dataService = createDataService(Astro.request);

// Hent artikler-siden innhold fra "Faste sider"
const articlesPage = await dataService.getPageBySlug('artikler');

// Hent alle publiserte artikler
const articles = await dataService.getPublishedArticles();

// Fallback values
const pageTitle = articlesPage?.title || 'Artikler';
---

<ContentPageLayout
  title={pageTitle}
  pageContent={articlesPage?.content}
>
  <CardGrid
    title="Alle artikler"
    items={articles}
    gridType="articles"
    noResultsTitle="Ingen artikler publisert"
  >
    {articles.map((article) => (
      <article class="article-card card">
        <a href={`/artikler/${article.slug}`} class="article-link">
          {article.image && (
            <div class="article-image">
              <Image
                image={article.image.image}
                alt={article.image.alt || article.title}
                caption=""
                credit=""
                size="full"
                aspectRatio="16:9"
                alignment="center"
                className="article-card-image"
              />
            </div>
          )}
          <div class="article-content">
            <h3 class="article-title">{article.title}</h3>

            {article.subtitle && (
              <p class="article-subtitle">{article.subtitle}</p>
            )}

            {article.publishedAt && (
              <div class="article-meta">
                <span class="article-date">
                  {formatDateForLanguage(article.publishedAt, 'no')}
                </span>
              </div>
            )}
          </div>
        </a>
      </article>
    ))}
  </CardGrid>

  <style>
    /* Article Card Specific Styles */
    .article-card {
      container-type: inline-size;
      overflow: hidden;
      transition: box-shadow var(--transition-base);
    }

    .article-link {
      text-decoration: none;
      color: inherit;
      display: block;
    }

    .article-image {
      position: relative;
      height: clamp(180px, 20cqw, 240px);
      overflow: hidden;
      aspect-ratio: 16/9;
    }

    .article-card-image .image-container {
      margin: 0;
      height: 100%;
    }

    .article-card-image .image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 0;
    }

    .article-card-image .image-caption {
      display: none;
    }

    .article-content {
      padding: 0;
    }

    .article-title {
      margin: 0 0 var(--space-2) 0;
      color: var(--color-text-primary);
      font-size: clamp(var(--font-size-lg), 4cqw, var(--font-size-xl));
      line-height: var(--line-height-tight);
    }

    .article-subtitle {
      margin: 0 0 var(--space-3) 0;
      color: var(--color-text-secondary);
      font-size: clamp(var(--font-size-sm), 3cqw, var(--font-size-base));
      line-height: var(--line-height-normal);
    }

    .article-meta {
      color: var(--color-text-secondary);
      font-size: var(--font-size-sm);
    }

    .article-date {
      display: flex;
      align-items: center;
      gap: var(--space-2);
    }

    /* Container Query Enhancements */
    @container (min-width: 350px) {
      .article-title {
        font-size: var(--font-size-xl);
      }

      .article-subtitle {
        font-size: var(--font-size-base);
      }
    }

    @container (min-width: 400px) {
      .article-image {
        height: 200px;
      }
    }
  </style>

</ContentPageLayout>