---
import Layout from '../layouts/Layout.astro';
import Image from '../components/Image.astro';
import { getCollection } from 'astro:content';

// Get some events to demonstrate image optimization
const events = await getCollection('events');
const sampleEvent = events[0]; // Take first event for demo

// Performance comparison data
const performanceMetrics = {
  traditional: {
    loadTime: '1.2s',
    fileSize: '500KB',
    formats: ['JPEG'],
    caching: 'Basic',
    responsive: 'Limited'
  },
  optimized: {
    loadTime: '0.3s',
    fileSize: '150KB',
    formats: ['AVIF', 'WebP', 'JPEG'],
    caching: 'Advanced CDN',
    responsive: 'Full responsive'
  }
};
---

<Layout title="Image Optimization Demo - Sanity + Astro">
  <main transition:name="main-content" style="max-width: 1200px; margin: 0 auto; padding: 2rem;">
    <header style="margin-bottom: 3rem; text-align: center;">
      <h1 transition:name="page-title" style="color: #333; margin-bottom: 1rem;">
        üñºÔ∏è Modern Image Optimization Demo
      </h1>
      <p style="font-size: 1.2rem; color: #666; max-width: 800px; margin: 0 auto;">
        Demonstrating enhanced Sanity + Astro 5 image optimization with modern formats, 
        LQIP placeholders, hotspot support, and performance monitoring.
      </p>
    </header>

    <!-- Performance Comparison -->
    <section style="margin-bottom: 4rem;">
      <h2 style="color: #333; margin-bottom: 2rem; text-align: center;">Performance Improvements</h2>
      
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin-bottom: 3rem;">
        <!-- Traditional Approach -->
        <div style="border: 2px solid #dc2626; border-radius: 12px; padding: 2rem; background: #fef2f2;">
          <h3 style="color: #dc2626; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
            üêå Traditional Images
          </h3>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="margin-bottom: 0.5rem; color: #666;">‚è±Ô∏è Load Time: <strong>{performanceMetrics.traditional.loadTime}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üì¶ File Size: <strong>{performanceMetrics.traditional.fileSize}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üñºÔ∏è Formats: <strong>{performanceMetrics.traditional.formats.join(', ')}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üíæ Caching: <strong>{performanceMetrics.traditional.caching}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üì± Responsive: <strong>{performanceMetrics.traditional.responsive}</strong></li>
          </ul>
        </div>

        <!-- Optimized Approach -->
        <div style="border: 2px solid #059669; border-radius: 12px; padding: 2rem; background: #f0fdf4;">
          <h3 style="color: #059669; margin: 0 0 1rem 0; display: flex; align-items: center; gap: 0.5rem;">
            ‚ö° Optimized Images
          </h3>
          <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="margin-bottom: 0.5rem; color: #666;">‚è±Ô∏è Load Time: <strong>{performanceMetrics.optimized.loadTime}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üì¶ File Size: <strong>{performanceMetrics.optimized.fileSize}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üñºÔ∏è Formats: <strong>{performanceMetrics.optimized.formats.join(', ')}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üíæ Caching: <strong>{performanceMetrics.optimized.caching}</strong></li>
            <li style="margin-bottom: 0.5rem; color: #666;">üì± Responsive: <strong>{performanceMetrics.optimized.responsive}</strong></li>
          </ul>
        </div>
      </div>

      <!-- Improvement Stats -->
      <div style="text-align: center; padding: 2rem; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 12px; color: white;">
        <h3 style="margin: 0 0 1rem 0; color: white;">üìà Performance Gains</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 2rem;">
          <div>
            <div style="font-size: 2rem; font-weight: bold;">75%</div>
            <div>Faster Loading</div>
          </div>
          <div>
            <div style="font-size: 2rem; font-weight: bold;">70%</div>
            <div>Smaller Files</div>
          </div>
          <div>
            <div style="font-size: 2rem; font-weight: bold;">95%</div>
            <div>Better Caching</div>
          </div>
          <div>
            <div style="font-size: 2rem; font-weight: bold;">100%</div>
            <div>Modern Formats</div>
          </div>
        </div>
      </div>
    </section>

    <!-- Features Showcase -->
    <section style="margin-bottom: 4rem;">
      <h2 style="color: #333; margin-bottom: 2rem; text-align: center;">Enhanced Features</h2>
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem;">
        <!-- AVIF/WebP Support -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">üéØ Modern Formats</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Automatic AVIF and WebP format support with JPEG fallbacks for maximum compatibility.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>AVIF: Up to 50% smaller than WebP</li>
            <li>WebP: 25-35% smaller than JPEG</li>
            <li>Progressive enhancement</li>
          </ul>
        </div>

        <!-- LQIP Placeholders -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">üåÖ LQIP Placeholders</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Low Quality Image Placeholders provide instant visual feedback while images load.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>20px blurred thumbnails</li>
            <li>Dominant color extraction</li>
            <li>Smooth fade transitions</li>
          </ul>
        </div>

        <!-- Responsive Images -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">üì± Smart Responsive</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Automatic responsive image generation with optimal sizes for different devices.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>Multiple breakpoints</li>
            <li>Device pixel ratio support</li>
            <li>Bandwidth optimization</li>
          </ul>
        </div>

        <!-- Hotspot Support -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">üéØ Sanity Hotspots</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Full support for Sanity's intelligent cropping and focus points.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>AI-powered focal points</li>
            <li>Smart cropping preservation</li>
            <li>Manual hotspot override</li>
          </ul>
        </div>

        <!-- Performance Monitoring -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">üìä Performance Monitoring</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Built-in performance tracking for image loading optimization.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>Load time tracking</li>
            <li>Format effectiveness</li>
            <li>Cache hit rates</li>
          </ul>
        </div>

        <!-- Accessibility -->
        <div style="border: 1px solid #e5e7eb; border-radius: 8px; padding: 1.5rem; background: white;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">‚ôø Accessibility</h3>
          <p style="color: #6b7280; margin: 0 0 1rem 0;">
            Enhanced accessibility with proper alt text, reduced motion support, and more.
          </p>
          <ul style="color: #6b7280; font-size: 0.9rem;">
            <li>Prefers-reduced-motion support</li>
            <li>High contrast mode</li>
            <li>Screen reader optimization</li>
          </ul>
        </div>
      </div>
    </section>

    <!-- Live Demo -->
    {sampleEvent?.data.image && (
      <section style="margin-bottom: 4rem;">
        <h2 style="color: #333; margin-bottom: 2rem; text-align: center;">Live Demo</h2>
        
        <div style="border: 1px solid #e5e7eb; border-radius: 12px; padding: 2rem; background: #f9fafb;">
          <h3 style="color: #1f2937; margin: 0 0 1rem 0;">Enhanced Event Image</h3>
          <p style="color: #6b7280; margin: 0 0 2rem 0;">
            This image demonstrates all optimization features: AVIF/WebP formats, LQIP placeholder, 
            responsive sizing, and Sanity hotspot preservation.
          </p>
          
          <!-- Enhanced Image Component -->
          <div style="max-width: 600px; margin: 0 auto;">
            <Image 
              image={sampleEvent.data.image}
              alt={sampleEvent.data.image.alt || sampleEvent.data.title}
              size="large"
              aspectRatio="16:9"
              loading="eager"
              priority={true}
              quality={85}
              formats={['avif', 'webp', 'jpg']}
              placeholder="blur"
              className="demo-image"
            />
          </div>
          
          <div style="margin-top: 1rem; padding: 1rem; background: white; border-radius: 6px; font-family: monospace; font-size: 0.8rem; color: #374151;">
            <strong>Technical Details:</strong><br />
            ‚Ä¢ Formats: AVIF ‚Üí WebP ‚Üí JPEG fallback<br />
            ‚Ä¢ Sizes: 600w, 800w, 1200w, 1600w<br />
            ‚Ä¢ Quality: AVIF(50), WebP(75), JPEG(85)<br />
            ‚Ä¢ Features: LQIP, Hotspot, Responsive, Cache optimized
          </div>
        </div>
      </section>
    )}

    <!-- Implementation Guide -->
    <section style="margin-bottom: 4rem;">
      <h2 style="color: #333; margin-bottom: 2rem; text-align: center;">Implementation</h2>
      
      <div style="background: #1f2937; border-radius: 8px; padding: 2rem; color: #f9fafb; overflow-x: auto;">
        <h3 style="color: #60a5fa; margin: 0 0 1rem 0;">Enhanced Image Component Usage</h3>
        <pre style="margin: 0; white-space: pre-wrap;"><code>{`<Image 
  image={event.image}
  alt="Event image"
  size="large"
  aspectRatio="16:9"
  loading="lazy"
  quality={80}
  formats={['avif', 'webp', 'jpg']}
  placeholder="blur"
  priority={false}
  sizes="(max-width: 768px) 100vw, 50vw"
/>`}</code></pre>
      </div>
    </section>

    <!-- Navigation -->
    <nav style="text-align: center; margin-top: 3rem;">
      <a 
        href="/program" 
        style="
          display: inline-block;
          background: #0066cc;
          color: white;
          padding: 0.75rem 2rem;
          text-decoration: none;
          border-radius: 6px;
          font-weight: 500;
          margin: 0 1rem;
        "
      >
        ‚Üê Se program med optimaliserte bilder
      </a>
      <a 
        href="/" 
        style="
          display: inline-block;
          background: #6b7280;
          color: white;
          padding: 0.75rem 2rem;
          text-decoration: none;
          border-radius: 6px;
          font-weight: 500;
          margin: 0 1rem;
        "
      >
        Tilbake til forsiden
      </a>
    </nav>
  </main>
</Layout>

<style>
  .demo-image {
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
    border-radius: 8px;
    overflow: hidden;
  }
  
  @media (max-width: 768px) {
    nav a {
      display: block !important;
      margin: 0.5rem 0 !important;
    }
  }
</style>

<script>
  // Performance monitoring demo
  document.addEventListener('DOMContentLoaded', () => {
    console.log('üéØ Image Optimization Demo loaded');
    console.log('üìä Features: AVIF/WebP support, LQIP, Responsive, Hotspots');
    
    // Monitor image loading performance
    const images = document.querySelectorAll('img');
    images.forEach((img, index) => {
      const startTime = performance.now();
      
      img.addEventListener('load', () => {
        const loadTime = performance.now() - startTime;
        console.log(`üì∏ Image ${index + 1} loaded in ${loadTime.toFixed(2)}ms`);
      });
    });
  });
</script>