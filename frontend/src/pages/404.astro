---
import Layout from '../layouts/Layout.astro';
import { sanityClient } from '../lib/sanity';
import { PageBuilder } from '../components/PageBuilder.astro';

// Fetch 404 error page content from Sanity
const errorPageData = await sanityClient.fetch(`
  *[_type == "error404"][0] {
    title_no,
    title_en,
    content_no,
    content_en,
    image,
    imageAlt_no,
    imageAlt_en,
    imageCredit_no,
    imageCredit_en
  }
`);

// Fallback content if no Sanity content exists
const fallbackContent = {
  title_no: "404 - Side ikke funnet",
  title_en: "404 - Page not found",
  message_no: "Beklager, vi finner ikke siden du leter etter. Siden kan ha blitt flyttet eller slettet.",
  message_en: "Sorry, we can't find the page you're looking for. The page may have been moved or deleted."
};

// Use Sanity content or fallback
const pageTitle = errorPageData?.title_no || fallbackContent.title_no;
---

<Layout
  title={pageTitle}
  noIndex={true}
>
  {errorPageData?.content_no ? (
    <!-- Use Sanity content if available -->
    <main class="error-page-custom">
      <h1>{pageTitle}</h1>
      <PageBuilder content={errorPageData.content_no} />
    </main>
  ) : (
    <!-- Fallback to hardcoded content -->
    <main class="error-page">
      <h1 class="error-code">404</h1>
      <h2 class="error-title">{fallbackContent.title_no}</h2>
      <p class="error-message">
        {fallbackContent.message_no} Sjekk at URL-en er riktig, eller gå tilbake til forsiden.
      </p>
      <div class="error-actions">
        <a href="/" class="btn btn-primary">
          Gå til forsiden
        </a>
        <a href="/program" class="btn btn-secondary">
          Se programmet
        </a>
      </div>
    </main>
  )}
</Layout>

<style>
  .error-page, .error-page-custom {
    min-height: 60vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    text-align: center;
  }

  .error-code {
    font-size: var(--font-size-5xl);
    margin: 0;
    color: var(--color-primary-500);
    font-weight: var(--font-weight-bold);
  }

  .error-title {
    margin: var(--space-4) 0;
  }

  .error-message {
    color: var(--color-text-secondary);
    margin: var(--space-5) 0;
    max-width: 500px;
  }

  .error-actions {
    margin-top: var(--space-6);
    display: flex;
    gap: var(--space-4);
  }

  @media (max-width: 768px) {
    .error-actions {
      flex-direction: column;
      width: 100%;
      max-width: 300px;
    }
  }
</style>