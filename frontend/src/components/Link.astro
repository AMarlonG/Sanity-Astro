---
export interface Props {
  text: string
  linkType: 'internal' | 'url' | 'email' | 'phone'
  internalLink?: {
    slug?: {
      current: string
    }
  }
  url?: string
  email?: string
  phone?: string
  openInNewTab?: boolean
  accessibility?: {
    ariaLabel?: string
    ariaDescribedBy?: string
  }
  className?: string
}

const {
  text,
  linkType,
  internalLink,
  url,
  email,
  phone,
  openInNewTab = false,
  accessibility,
  className = ''
} = Astro.props

// Generer href basert på lenketype
let href = '#'
let target = ''
let rel = ''
let isValidLink = false

switch (linkType) {
  case 'internal':
    if (internalLink?.slug?.current) {
      href = `/${internalLink.slug.current}`
      isValidLink = true
    }
    break
  case 'url':
    if (url) {
      href = url
      isValidLink = true
      // Automatisk åpne eksterne lenker i ny fane
      const isExternal = url.startsWith('http') && !url.includes(Astro.site?.hostname || 'localhost')
      if (openInNewTab || isExternal) {
        target = '_blank'
        rel = 'noopener noreferrer'
      }
    }
    break
  case 'email':
    if (email) {
      href = `mailto:${email}`
      isValidLink = true
    }
    break
  case 'phone':
    if (phone) {
      href = `tel:${phone}`
      isValidLink = true
    }
    break
}

// Fallback for ugyldige lenker
if (!isValidLink) {
  console.warn('Link component: Invalid or missing link data', { linkType, internalLink, url, email, phone })
}

// Bygg ARIA-attributter
const ariaAttributes: Record<string, string> = {}
if (accessibility?.ariaLabel) {
  ariaAttributes['aria-label'] = accessibility.ariaLabel
}
if (accessibility?.ariaDescribedBy) {
  ariaAttributes['aria-describedby'] = accessibility.ariaDescribedBy
}
---

<a 
  href={href}
  {target}
  {rel}
  class={`link-component ${className}`}
  data-astro-prefetch={linkType === 'internal' ? true : undefined}
  {...ariaAttributes}
>
  {text}
</a>

<style>
  .link-component {
    color: #0066cc;
    text-decoration: underline;
    text-underline-offset: 0.2em;
    text-decoration-thickness: 1px;
    transition: all 0.2s ease;
    min-height: 44px;
    display: inline-block;
    padding: 0.25rem 0;
    word-break: break-word;
  }

  .link-component:hover {
    color: #004499;
    text-decoration-thickness: 2px;
  }

  .link-component:focus {
    outline: 2px solid #0066cc;
    outline-offset: 2px;
    background: rgba(0, 102, 204, 0.1);
    border-radius: 2px;
  }

  /* Moderne focus-visible for bedre tastaturnavigasjon */
  .link-component:focus-visible {
    outline: 2px solid #0066cc;
    outline-offset: 2px;
    background: rgba(0, 102, 204, 0.1);
    border-radius: 2px;
  }

  /* Forbedret kontrast for visited lenker */
  .link-component:visited {
    color: #663399;
  }

  .link-component:visited:hover {
    color: #442266;
  }

  /* Eksterne lenker indikator */
  .link-component[target="_blank"]::after {
    content: ' ↗';
    font-size: 0.8em;
    opacity: 0.7;
    margin-left: 0.2em;
  }

  /* Mobiloptimalisering */
  @media (max-width: 768px) {
    .link-component {
      min-height: 48px;
      padding: 0.5rem 0;
    }
  }

  /* High contrast mode support */
  @media (prefers-contrast: high) {
    .link-component {
      text-decoration-thickness: 2px;
    }
  }

  /* Reduced motion support */
  @media (prefers-reduced-motion: reduce) {
    .link-component {
      transition: none;
    }
  }
</style> 