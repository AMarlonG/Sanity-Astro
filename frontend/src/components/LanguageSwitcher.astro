---
import type { Language } from '../lib/utils/language';

interface Props {
  currentLang: Language;
  currentPath: string;
  slugNo?: string;
  slugEn?: string;
}

const { currentLang, currentPath, slugNo, slugEn } = Astro.props;

// Build alternate language URL (without trailing slash)
const buildAlternateUrl = (): string => {
  if (currentLang === 'no') {
    // Switching to English
    if (slugEn) {
      // Dynamic page with English slug
      const pathParts = currentPath.split('/').filter(p => p);
      pathParts[pathParts.length - 1] = slugEn;
      return `/en/${pathParts.join('/')}`;
    }
    // Static page - handle root specially
    if (currentPath === '/' || currentPath === '') {
      return '/en';
    }
    return `/en${currentPath}`;
  } else {
    // Switching to Norwegian
    if (slugNo) {
      // Dynamic page with Norwegian slug
      const pathParts = currentPath.replace(/^\/en\/?/, '').split('/').filter(p => p);
      pathParts[pathParts.length - 1] = slugNo;
      return `/${pathParts.join('/')}`;
    }
    // Static page - handle root specially
    const cleanPath = currentPath.replace(/^\/en\/?/, '/');
    if (cleanPath === '/' || cleanPath === '') {
      return '/';
    }
    return cleanPath;
  }
};

const alternateUrl = buildAlternateUrl();
const alternateLang = currentLang === 'no' ? 'en' : 'no';
const alternateLangLabel = currentLang === 'no' ? 'English' : 'Norsk';
---

<div class="language-switcher">
  <a href={alternateUrl} class="language-link" hreflang={alternateLang}>
    {alternateLangLabel}
  </a>
</div>

<style>
  .language-switcher {
    display: inline-flex;
    align-items: center;
  }

  .language-link {
    padding: var(--space-2, 0.5rem) var(--space-3, 0.75rem);
    text-decoration: none;
    color: var(--color-text-primary, #333);
    background: var(--color-surface, #f5f5f5);
    border: 1px solid var(--color-border, #ddd);
    border-radius: var(--radius-sm, 4px);
    font-size: var(--font-size-sm, 0.875rem);
    font-weight: var(--font-weight-medium, 500);
    transition: all 0.2s ease;
  }

  .language-link:hover {
    background: var(--color-surface-hover, #e9e9e9);
    border-color: var(--color-border-hover, #ccc);
  }

  .language-link:focus {
    outline: 2px solid var(--color-focus, #007acc);
    outline-offset: 2px;
  }
</style>
