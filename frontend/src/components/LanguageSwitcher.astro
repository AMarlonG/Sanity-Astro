---
import { 
  getCurrentLanguage, 
  createLanguageToggleUrl, 
  getLanguageDisplayName, 
  getLanguageFlag 
} from '../lib/languageUtils';

// Get current language from request
const currentLanguage = getCurrentLanguage(Astro.request);

// Create toggle URL
const toggleUrl = createLanguageToggleUrl(Astro.url.toString(), currentLanguage);

// Get display info for current and opposite languages
const currentDisplayName = getLanguageDisplayName(currentLanguage);
const currentFlag = getLanguageFlag(currentLanguage);
const toggleDisplayName = getLanguageDisplayName(currentLanguage === 'no' ? 'en' : 'no');
const toggleFlag = getLanguageFlag(currentLanguage === 'no' ? 'en' : 'no');
---

<div class="language-switcher">
  <span class="current-language">
    {currentFlag} {currentDisplayName}
  </span>
  <a 
    href={toggleUrl} 
    class="language-toggle"
    aria-label={currentLanguage === 'no' ? 'Switch to English' : 'Bytt til norsk'}
    title={currentLanguage === 'no' ? 'Switch to English' : 'Bytt til norsk'}
  >
    {toggleFlag} {toggleDisplayName}
  </a>
</div>

<style>
  .language-switcher {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.9rem;
  }
  
  .current-language {
    color: var(--color-text-secondary, #666);
    font-weight: 500;
  }
  
  .language-toggle {
    color: var(--color-primary, #007acc);
    text-decoration: none;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    border: 1px solid var(--color-primary, #007acc);
    background: transparent;
    transition: all 0.2s ease;
    font-size: inherit;
    font-weight: 500;
  }
  
  .language-toggle:hover {
    background: var(--color-primary, #007acc);
    color: white;
    transform: translateY(-1px);
  }
  
  .language-toggle:active {
    transform: translateY(0);
  }
  
  /* Responsive adjustments */
  @media (max-width: 768px) {
    .language-switcher {
      font-size: 0.8rem;
    }
    
    .language-toggle {
      padding: 0.2rem 0.4rem;
    }
  }
</style>