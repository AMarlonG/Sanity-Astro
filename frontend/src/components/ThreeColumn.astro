---
import DynamicComponent from './DynamicComponent.astro'

export interface Props {
  column1: any[]
  column2: any[]
  column3: any[]
  aspectRatio?: '4:5' | '9:16' | '1:1'
  className?: string
  _key?: string
  _type?: string
}

const {
  column1 = [],
  column2 = [],
  column3 = [],
  aspectRatio = '4:5',
  className = '',
  _key,
  _type,
} = Astro.props

const item1 = column1[0]
const item2 = column2[0]
const item3 = column3[0]

// Convert aspectRatio string to CSS value
const aspectMap: Record<string, string> = {
  '4:5': '4 / 5',
  '9:16': '9 / 16',
  '1:1': '1 / 1',
}
const aspectValue = aspectMap[aspectRatio] || '4 / 5'

// Sanity Visual Editing attributes
const sanityAttributes = _key ? { 'data-sanity': `${_type}.${_key}` } : {}
---

<section
  class={`three-column-layout content-wide ${className}`}
  data-layout-context="three-column"
  style={`--column-aspect-ratio: ${aspectValue}`}
  {...sanityAttributes}
>
    <div class="column column-1">
      {item1 && <DynamicComponent block={item1} />}
    </div>

    <div class="column column-2">
      {item2 && <DynamicComponent block={item2} />}
    </div>

    <div class="column column-3">
      {item3 && <DynamicComponent block={item3} />}
    </div>
</section>

<style>
  .three-column-layout {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 2rem;
    margin: 3rem 0;
    align-items: start;

    /* Container query context - allows children to adapt to available space */
    container-type: inline-size;
    container-name: three-column-layout;
  }

  .column {
    width: 100%;
    aspect-ratio: var(--column-aspect-ratio, 4 / 5);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 300px; /* Prevent tiny boxes */

    /* Performance optimizations */
    contain: layout style paint;
    content-visibility: auto;
  }

  /* Media content: Fill and crop */
  .column > :global(.image-container),
  .column > :global(.image-wrapper),
  .column > :global([data-component="video"]) {
    width: 100%;
    height: 100%;
    flex: 1;
  }

  .column > :global(.image-wrapper img),
  .column > :global(.image) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Text content: Scrollable within aspect ratio */
  .column > :global([data-component="quote"]) {
    overflow-y: auto;
    height: 100%;
    padding: 1.5rem;

    /* Custom scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar {
    width: 8px;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
  }

  /* Nested layouts: Disable aspect ratio enforcement */
  .column > :global([data-layout-context]) {
    aspect-ratio: auto !important;
    overflow: visible !important;
    height: auto !important;
    contain: none;
  }

  /* Tablet: Reduce to 2 columns, stack third */
  @media (max-width: 1024px) {
    .three-column-layout {
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .column-3 {
      grid-column: 1 / -1; /* Span full width */
    }
  }

  /* Mobile: Stack vertically */
  @media (max-width: 768px) {
    .three-column-layout {
      grid-template-columns: 1fr;
      gap: 2rem;
      margin: 2rem 0;
    }

    .column-3 {
      grid-column: auto; /* Reset span */
    }
  }

  /* Accessibility */
  .column:focus-within {
    outline: 2px solid #0066cc;
    outline-offset: 4px;
  }

  /* Print styles */
  @media print {
    .three-column-layout {
      display: block;
    }

    .column {
      page-break-inside: avoid;
      margin-bottom: 1rem;
      aspect-ratio: auto;
      overflow: visible;
      contain: none;
      min-height: auto;
    }

    .column > :global([data-component="quote"]) {
      overflow-y: visible;
      height: auto;
    }
  }
</style>
