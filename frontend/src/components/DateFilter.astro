---
import { formatDateWithWeekday } from '../lib/utils/dates';

interface Props {
  availableDates: Array<{ date: string; title?: string }>;
  language: 'no' | 'en';
}

const { availableDates, language } = Astro.props;

// Extract unique dates from events and sort
const uniqueDates = Array.from(
  new Set(availableDates.map(d => d.date))
).sort();

// Get current date from URL
const currentDate = Astro.url.searchParams.get('date') || '';
---

{uniqueDates.length > 0 && (
  <div class="date-filter">
    <div class="date-filter-buttons">
      <a
        href={language === 'no' ? '/program' : '/en/program'}
        class:list={['date-button', { active: !currentDate }]}
        hx-boost="true"
      >
        {language === 'no' ? 'Alle datoer' : 'All dates'}
      </a>

      {uniqueDates.map(date => (
        <a
          href={`${language === 'no' ? '/program' : '/en/program'}?date=${date}`}
          class:list={['date-button', { active: currentDate === date }]}
          hx-boost="true"
        >
          {formatDateWithWeekday(date, language)}
        </a>
      ))}
    </div>
  </div>
)}
