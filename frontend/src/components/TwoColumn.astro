---
import DynamicComponent from './DynamicComponent.astro'

export interface Props {
  leftColumn: any[]
  rightColumn: any[]
  reverseOnMobile?: boolean
  aspectRatio?: '4:5' | '9:16' | '1:1'
  className?: string
  _key?: string
  _type?: string
}

const {
  leftColumn = [],
  rightColumn = [],
  reverseOnMobile = false,
  aspectRatio = '4:5',
  className = '',
  _key,
  _type,
} = Astro.props

const leftItem = leftColumn[0]
const rightItem = rightColumn[0]

// Convert aspectRatio string to CSS value
const aspectMap: Record<string, string> = {
  '4:5': '4 / 5',
  '9:16': '9 / 16',
  '1:1': '1 / 1',
}
const aspectValue = aspectMap[aspectRatio] || '4 / 5'

// Sanity Visual Editing attributes
const sanityAttributes = _key ? { 'data-sanity': `${_type}.${_key}` } : {}
---

<section
  class={`two-column-layout content-wide ${reverseOnMobile ? 'reverse-mobile' : ''} ${className}`}
  data-layout-context="two-column"
  style={`--column-aspect-ratio: ${aspectValue}`}
  {...sanityAttributes}
>
    <div class="column column-left">
      {leftItem && <DynamicComponent block={leftItem} />}
    </div>

    <div class="column column-right">
      {rightItem && <DynamicComponent block={rightItem} />}
    </div>
</section>

<style>
  .two-column-layout {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
    margin: 3rem 0;
    align-items: stretch; /* Columns stretch to match height */

    /* Container query context - allows children to adapt to available space */
    container-type: inline-size;
    container-name: two-column-layout;
  }

  .column {
    width: 100%;
    aspect-ratio: var(--column-aspect-ratio, 4 / 5);
    overflow: hidden;
    display: flex;
    flex-direction: column;
    min-height: 300px; /* Prevent tiny boxes */

    /* Performance optimizations */
    contain: layout style paint;
    content-visibility: auto;
  }

  /* Media content: Fill and crop */
  .column > :global(.image-container),
  .column > :global(.image-wrapper),
  .column > :global([data-component="video"]) {
    width: 100%;
    height: 100%;
    flex: 1;
  }

  .column > :global(.image-wrapper img),
  .column > :global(.image) {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  /* Components that fill column space and respect aspect ratio */
  .column > :global([data-component="spotify"]),
  .column > :global([data-component="quote"]),
  .column > :global([data-component="video"]) {
    width: 100%;
    height: 100%;
    flex: 1;
  }

  /* Text content: Scrollable within fixed height */
  .column > :global([data-component="quote"]),
  .column > :global([data-component="text"]),
  .column > :global(.portable-text) {
    overflow-y: auto;
    height: 100%;
    padding: 1.5rem;

    /* Custom scrollbar styling */
    scrollbar-width: thin;
    scrollbar-color: rgba(0, 0, 0, 0.3) transparent;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar,
  .column > :global([data-component="text"])::-webkit-scrollbar,
  .column > :global(.portable-text)::-webkit-scrollbar {
    width: 8px;
  }

  .column > :global([data-component="quote"])::-webkit-scrollbar-thumb,
  .column > :global([data-component="text"])::-webkit-scrollbar-thumb,
  .column > :global(.portable-text)::-webkit-scrollbar-thumb {
    background-color: rgba(0, 0, 0, 0.3);
    border-radius: 4px;
  }

  /* Nested layouts: Natural height */
  .column > :global([data-layout-context]) {
    aspect-ratio: auto;
    height: auto;
    overflow: visible;
  }


  /* Tablet: Reduce gap */
  @media (max-width: 1024px) {
    .two-column-layout {
      gap: 2rem;
    }
  }

  /* Mobile: Stack vertically */
  @media (max-width: 768px) {
    .two-column-layout {
      grid-template-columns: 1fr;
      gap: 2rem;
      margin: 2rem 0;
    }

    /* Reverse column order on mobile if specified */
    .two-column-layout.reverse-mobile {
      display: flex;
      flex-direction: column-reverse;
    }
  }

  /* Accessibility */
  .column:focus-within {
    outline: 2px solid #0066cc;
    outline-offset: 4px;
  }

  /* Print styles */
  @media print {
    .two-column-layout {
      display: block;
    }

    .column {
      page-break-inside: avoid;
      margin-bottom: 1rem;
      aspect-ratio: auto;
      overflow: visible;
      contain: none;
      min-height: auto;
    }

    .column > :global([data-component="quote"]),
    .column > :global([data-component="text"]),
    .column > :global(.portable-text) {
      overflow-y: visible;
      height: auto;
    }
  }
</style>
